# Dynamic redis_client access
def _get_redis_client():
    """Get redis_client dynamically to avoid import-time errors"""
    from HYPERRSI.src.core import database as db_module
    return db_module.redis_client

# redis_client = _get_redis_client()  # Removed - causes import-time error

# Module-level attribute for backward compatibility
def __getattr__(name):
    if name == "redis_client":
        return _get_redis_client()
    raise AttributeError(f"module has no attribute {name}")

async def get_symbol_status(user_id: str, symbol: str) -> str:
    """
    사용자의 특정 심볼에 대한 트레이딩 상태를 반환합니다.
    """
    key = f"user:{user_id}:trading:status"
    result = await _get_redis_client().get(key)
    return str(result) if result else ""

async def set_symbol_status(user_id: str, symbol: str, status: str) -> None:
    """
    사용자의 특정 심볼에 대한 트레이딩 상태를 설정합니다.
    """
    key = f"user:{user_id}:{symbol}:status"
    await _get_redis_client().set(key, status)
    
    
async def get_all_symbol_statuses(user_id: str) -> dict:
    """
    사용자의 모든 심볼에 대한 트레이딩 상태를 반환합니다.
    """
    key = f"user:{user_id}:*:status"
    keys = await _get_redis_client().keys(key)
    return {k: await _get_redis_client().get(k) for k in keys} if keys else {}


async def get_universal_status(user_id: str, symbol: str = "BTC-USDT-SWAP") -> str:
    """
    사용자의 기본 심볼에 대한 트레이딩 상태를 반환합니다.
    """
    key = f"user:{user_id}:trading:status"
    result = await _get_redis_client().get(key)
    return str(result) if result else ""

async def check_is_running(user_id: str, symbol: str = "BTC-USDT-SWAP") -> bool:
    """
    사용자의 특정 심볼에 대한 트레이딩 상태를 반환합니다.
    """
    status = await get_universal_status(user_id, symbol)
    return status == "running"